# Проект 2: Валидатор JSON-схем

Инструмент для валидации JSON-данных против упрощённых JSON-схем.

## Обзор

Этот проект объединяет концепции из:
- **Глава 10**: Фантомные типы для безопасности типов
- **Глава 14**: Работа с JSON
- **Глава 16**: Property-Based Testing

**Цель**: Создать CLI-инструмент, который читает JSON-схему и JSON-данные, и проверяет, соответствуют ли данные схеме.

## Структура проекта

```
lib/
├── error.ml        -- Типы ошибок валидации с путями
├── schema.ml       -- Определение схем и конструкторы
└── validator.ml    -- Основная логика валидации

bin/
└── main.ml         -- CLI интерфейс

test/
└── test_validator.ml -- Unit-тесты + Property-Based тесты
```

## Сборка и запуск

```bash
# Сборка
dune build

# Тесты
dune runtest

# Запуск CLI
dune exec schema-validator -- schema.json data.json
```

## Примеры использования

### Простая схема строки

**schema.json:**
```json
{
  "type": "string",
  "minLength": 3,
  "maxLength": 10
}
```

**valid.json:**
```json
"hello"
```

**invalid.json:**
```json
"ab"
```

### Схема объекта

**user-schema.json:**
```json
{
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "minLength": 1
    },
    "age": {
      "type": "number",
      "minimum": 0
    },
    "email": {
      "type": "string",
      "pattern": ".*@.*"
    }
  },
  "required": ["name", "age"]
}
```

## Поддерживаемые типы и ограничения

### Строки
- `minLength` — минимальная длина
- `maxLength` — максимальная длина
- `pattern` — regex-паттерн

### Числа
- `minimum` — минимальное значение
- `maximum` — максимальное значение
- `multipleOf` — кратность

### Массивы
- `minItems` — минимальное количество элементов
- `maxItems` — максимальное количество элементов
- `uniqueItems` — элементы должны быть уникальными
- `items` — схема для элементов массива

### Объекты
- `properties` — схемы для полей
- `required` — обязательные поля

### Комбинаторы
- `anyOf` — хотя бы одна схема должна подходить
- `allOf` — все схемы должны подходить

## Этапы разработки

См. [GUIDE.md](./GUIDE.md) для пошаговых инструкций.

1. **Типы схем** (45 мин) — определение типов и конструкторов
2. **Типы ошибок** (30 мин) — информативные сообщения об ошибках
3. **Валидатор** (90 мин) — основная логика валидации
4. **CLI** (45 мин) — интерфейс командной строки
5. **Property-Based Testing** (60 мин) — генеративные тесты
6. **Расширения** (опционально) — фантомные типы, дополнительные функции

## Зависимости

- `yojson` — работа с JSON
- `cmdliner` — CLI парсинг
- `alcotest` — unit-тесты
- `qcheck` — property-based тесты

## Критерии успеха

- [ ] Все базовые типы JSON поддерживаются
- [ ] Все ограничения корректно проверяются
- [ ] Ошибки включают полные пути к проблемным местам
- [ ] CLI работает с файлами
- [ ] Unit-тесты проходят
- [ ] Property-based тесты проходят
- [ ] Код хорошо типизирован

## Ресурсы

- [JSON Schema Specification](https://json-schema.org/)
- [Yojson Documentation](https://ocaml-community.github.io/yojson/)
- [QCheck Tutorial](https://github.com/c-cube/qcheck)
