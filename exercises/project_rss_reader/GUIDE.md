# RSS Reader ‚Äî –ü–æ—à–∞–≥–æ–≤—ã–π –≥–∞–π–¥

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–í—ã —Å–æ–∑–¥–∞–¥–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π RSS-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π:
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç RSS URL
- –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∏–¥—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ
- –ü–∞—Ä—Å–∏—Ç XML
- –•—Ä–∞–Ω–∏—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–æ—Å—Ç—ã
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

**–í—Ä–µ–º—è:** 6-8 —á–∞—Å–æ–≤  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≥–ª–∞–≤—ã:** 8 (–≤–∞–ª–∏–¥–∞—Ü–∏—è), 12 (Eio), 14 (HTTP/XML), 15 (CLI)

## üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ URL
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ URL –≤–µ–¥—ë—Ç –Ω–∞ RSS —Ñ–∏–¥
   - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–æ–¥–∏–Ω URL –Ω–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –¥–≤–∞–∂–¥—ã)

2. **–ó–∞–≥—Ä—É–∑–∫–∞**
   - –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∏–¥–æ–≤ —á–µ—Ä–µ–∑ Eio
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ network –æ—à–∏–±–æ–∫
   - Timeout –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

3. **–ü–∞—Ä—Å–∏–Ω–≥**
   - –ü–∞—Ä—Å–∏–Ω–≥ RSS 2.0 —Ñ–æ—Ä–º–∞—Ç–∞
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –æ–ø–∏—Å–∞–Ω–∏–π, –¥–∞—Ç
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ XML

4. **–•—Ä–∞–Ω–µ–Ω–∏–µ**
   - In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∏–¥–æ–≤ –∏ –ø–æ—Å—Ç–æ–≤
   - Deduplicate –ø–æ—Å—Ç–æ–≤ –ø–æ GUID/link

5. **CLI**
   - `add <url>` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–¥
   - `list` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ñ–∏–¥—ã
   - `posts` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–æ—Å—Ç–æ–≤
   - `update` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ñ–∏–¥—ã

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cohttp-eio` –¥–ª—è HTTP
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ezxmlm` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ XML
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cmdliner` –¥–ª—è CLI
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞
- Mock HTTP –∑–∞–ø—Ä–æ—Å—ã –≤ —Ç–µ—Å—Ç–∞—Ö

## üìù –®–∞–≥ 1: –í–∞–ª–∏–¥–∞—Ü–∏—è URL (45 –º–∏–Ω—É—Ç)

### 1.1. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥—É–ª—å Validator

**–§–∞–π–ª:** `lib/validator.ml`

```ocaml
(** URL –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è RSS —Ñ–∏–¥–æ–≤. *)

type url = string

type validation_error =
  | Empty_url
  | Invalid_scheme  (* —Ç–æ–ª—å–∫–æ http/https *)
  | Invalid_format
  | Already_exists

(** –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å URL.
    Ok url –µ—Å–ª–∏ –≤–∞–ª–∏–¥–µ–Ω, Error –ø—Ä–∏—á–∏–Ω–∞ –µ—Å–ª–∏ –Ω–µ—Ç. *)
let validate_url (url : url) ~(existing : url list) : (url, validation_error) result =
  (* TODO: —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é *)
  failwith "TODO: Implement validate_url"

(** –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –≤ —á–∏—Ç–∞–µ–º–æ–º –≤–∏–¥–µ *)
let show_error : validation_error -> string = function
  | Empty_url -> "URL –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
  | Invalid_scheme -> "URL –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http:// –∏–ª–∏ https://"
  | Invalid_format -> "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL"
  | Already_exists -> "–≠—Ç–æ—Ç URL —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω"
```

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ URL –Ω–µ –ø—É—Å—Ç–æ–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å http:// –∏–ª–∏ https://
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ URL –≤–∞–ª–∏–¥–µ–Ω (—Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–º–µ–Ω)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ URL –Ω–µ –≤ —Å–ø–∏—Å–∫–µ existing

### 1.2. –¢–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞

**–§–∞–π–ª:** `test/test_validator.ml`

```ocaml
let valid_url_tests =
  let open Alcotest in
  [
    test_case "–≤–∞–ª–∏–¥–Ω—ã–π HTTP URL –ø—Ä–æ—Ö–æ–¥–∏—Ç" `Quick (fun () ->
      match Rss_reader.Validator.validate_url "http://example.com/feed" ~existing:[] with
      | Ok _ -> ()
      | Error e -> fail (Rss_reader.Validator.show_error e));

    test_case "–ø—É—Å—Ç–æ–π URL –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è" `Quick (fun () ->
      match Rss_reader.Validator.validate_url "" ~existing:[] with
      | Error Empty_url -> ()
      | _ -> fail "–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ Empty_url");

    test_case "–¥—É–±–ª–∏–∫–∞—Ç URL –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è" `Quick (fun () ->
      let url = "http://example.com/feed" in
      match Rss_reader.Validator.validate_url url ~existing:[url] with
      | Error Already_exists -> ()
      | _ -> fail "–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ Already_exists");
  ]
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑—É–π—Ç–µ `validate_url`
- [ ] –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è FTP —Å—Ö–µ–º—ã (–¥–æ–ª–∂–Ω–∞ –æ—Ç–∫–ª–æ–Ω—è—Ç—å—Å—è)
- [ ] –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö URL
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–µ `dune test`

## üìù –®–∞–≥ 2: –ü–∞—Ä—Å–∏–Ω–≥ RSS XML (90 –º–∏–Ω—É—Ç)

### 2.1. –¢–∏–ø—ã –¥–ª—è RSS

**–§–∞–π–ª:** `lib/feed_parser.ml`

```ocaml
(** RSS feed parser. *)

type post = {
  title : string;
  link : string;
  description : string option;
  pub_date : string option;
  guid : string option;
}

type feed = {
  title : string;
  link : string;
  description : string;
  posts : post list;
}

(** –ü–∞—Ä—Å–∏—Ç—å RSS XML —Å—Ç—Ä–æ–∫—É. *)
let parse (xml_string : string) : (feed, string) result =
  (* TODO: —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–∞—Ä—Å–µ—Ä *)
  failwith "TODO: Implement RSS parser"
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `ezxmlm`: `opam install ezxmlm`
- [ ] –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥ RSS 2.0
- [ ] –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ RSS
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–∞—Ä—Å–µ—Ä

## üìù –®–∞–≥ 3: HTTP –∑–∞–≥—Ä—É–∑–∫–∞ —Å Eio (60 –º–∏–Ω—É—Ç)

**–§–∞–π–ª:** `lib/downloader.ml`

```ocaml
type download_error =
  | Network_error of string
  | Timeout

(** –°–∫–∞—á–∞—Ç—å URL —Å timeout —á–µ—Ä–µ–∑ Eio –∏ cohttp-eio *)
let fetch ~(sw : Eio.Switch.t) ~(net : Eio.Net.t) ~(timeout : float) (url : string) 
    : (string, download_error) result =
  (* TODO: —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ HTTP –∫–ª–∏–µ–Ω—Ç *)
  failwith "TODO: Implement HTTP downloader"

(** –°–∫–∞—á–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ URL –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ *)
let fetch_all ~sw ~net ~timeout (urls : string list) 
    : (string * (string, download_error) result) list =
  (* TODO: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Eio.Fiber.List.map *)
  failwith "TODO: Implement concurrent fetch"
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `cohttp-eio`: `opam install cohttp-eio`
- [ ] –†–µ–∞–ª–∏–∑—É–π—Ç–µ `fetch` —Å timeout
- [ ] –†–µ–∞–ª–∏–∑—É–π—Ç–µ `fetch_all` –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å mock —Å–µ—Ä–≤–µ—Ä–æ–º

## üìù –®–∞–≥ 4: –•—Ä–∞–Ω–∏–ª–∏—â–µ (45 –º–∏–Ω—É—Ç)

**–§–∞–π–ª:** `lib/storage.ml`

```ocaml
type t = {
  mutable feeds : (string * Feed_parser.feed) list;  (* url, feed *)
  mutable all_posts : Feed_parser.post list;
}

let create () : t = { feeds = []; all_posts = [] }

let add_feed (storage : t) ~(url : string) (feed : Feed_parser.feed) 
    : (unit, string) result =
  (* TODO: –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–¥, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã *)
  failwith "TODO"

let get_feeds (storage : t) : (string * Feed_parser.feed) list =
  storage.feeds

let get_recent_posts (storage : t) ~(limit : int) : Feed_parser.post list =
  (* TODO: –≤–µ—Ä–Ω—É—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –ø–æ—Å—Ç–æ–≤ *)
  failwith "TODO"
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑—É–π—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –î–æ–±–∞–≤—å—Ç–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –ø–æ—Å—Ç–æ–≤ –ø–æ guid/link
- [ ] –°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ—Å—Ç—ã –ø–æ pub_date
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è Storage

## üìù –®–∞–≥ 5: CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (90 –º–∏–Ω—É—Ç)

**–§–∞–π–ª:** `bin/main.ml`

```ocaml
open Cmdliner
open Rss_reader

let storage = Storage.create ()

(* –ö–æ–º–∞–Ω–¥–∞: add <url> *)
let add_cmd =
  let add url =
    Eio_main.run @@ fun env ->
    let net = Eio.Stdenv.net env in
    Eio.Switch.run @@ fun sw ->
    (* 1. –í–∞–ª–∏–¥–∞—Ü–∏—è *)
    let existing = Storage.get_feeds storage |> List.map fst in
    match Validator.validate_url url ~existing with
    | Error e ->
        Printf.eprintf "–û—à–∏–±–∫–∞: %s\n" (Validator.show_error e);
        exit 1
    | Ok url ->
        (* 2. –ó–∞–≥—Ä—É–∑–∫–∞ *)
        match Downloader.fetch ~sw ~net ~timeout:5.0 url with
        | Error _ -> Printf.eprintf "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∏–¥\n"; exit 1
        | Ok xml ->
            (* 3. –ü–∞—Ä—Å–∏–Ω–≥ *)
            match Feed_parser.parse xml with
            | Error e -> Printf.eprintf "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: %s\n" e; exit 1
            | Ok feed ->
                (* 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ *)
                let _ = Storage.add_feed storage ~url feed in
                Printf.printf "–§–∏–¥ –¥–æ–±–∞–≤–ª–µ–Ω: %s\n" feed.title
  in
  let url_arg = Arg.(required & pos 0 (some string) None & info []) in
  Cmd.v (Cmd.info "add" ~doc:"–î–æ–±–∞–≤–∏—Ç—å RSS —Ñ–∏–¥") Term.(const add $ url_arg)

(* TODO: —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã *)

let () =
  let doc = "RSS Reader ‚Äî –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π RSS –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä" in
  let default_cmd = Cmd.group (Cmd.info "rss-reader" ~doc) [add_cmd] in
  exit (Cmd.eval default_cmd)
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `list`
- [ ] –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `posts`
- [ ] –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `update`
- [ ] –î–æ–±–∞–≤—å—Ç–µ —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥
- [ ] –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ storage –≤ —Ñ–∞–π–ª

## üéâ –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –¢–µ—Å—Ç—ã
cd exercises/project_rss_reader
dune test

# –ó–∞–ø—É—Å–∫
dune exec rss-reader add "https://news.ycombinator.com/rss"
dune exec rss-reader list
dune exec rss-reader posts
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: SQLite –≤–º–µ—Å—Ç–æ –ø–∞–º—è—Ç–∏
- [ ] Web UI: Dream —Å–µ—Ä–≤–µ—Ä
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–∞—Ö
- [ ] –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- [ ] OPML –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∑–Ω–∞–Ω–∏—è –∏–∑ –≥–ª–∞–≤ 8, 12, 14, 15 –∏ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–ª–∏—á–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ OCaml!
